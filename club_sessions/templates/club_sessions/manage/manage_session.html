{#------------------------------------------------------------------------------#}
{#                                                                              #}
{# High level page for Club Sessions. Present the tabs and uses HTMX to manage. #}
{#                                                                              #}
{#------------------------------------------------------------------------------#}
{% extends 'base.html' %}

{% load static %}
{% load cobalt_tags %}

{% block title %}- {{ session.session_date }}{% endblock %}

{% block header %}
    <style>
        .amount-paid-change {
            background-color: lightgreen;
        }
    </style>
{% endblock header %}

{% block content %}

    <h1 class="text-center pt-4"><span id="t_club_name">{{ club }}</span> - {{ club.state }}</h1>

    <h2 class="text-center border-bottom-0"><span class="text-primary" style="font-size: 50px;">&hearts;</span>
        {{ session.description}} <span class="text-danger" style="font-size: 50px;">&hearts;</span>
    </h2>

    <h3 class="text-center mx-0"><span class="text-dark" style="font-size: 40px;">&spades;</span>
        {{ session.session_date }} <span class="text-dark" style="font-size: 40px;">&spades;</span>
    </h3>

    <!-- MAIN CARD BODY -->
    <div class="card-body">

        <!-- NAVIGATION CARD -->
        <div class="card">

            <!-- NAVIGATION CARD HEADER -->
            <div class="card-header card-header-secondary pb-0">

                <!-- BUTTONS ACROSS THE TOP -->
                <ul id="id_menu" class="nav nav-pills nav-pills-icons" role="tablist">

                    <!-- SETTINGS -->
                    <li class="nav-item">
                        <a id="id_tab_basics" class="nav-link auto-refresh" href="#basics" role="tab" data-toggle="tab">
                            <i class="material-icons">settings</i>
                            Settings
                        </a>
                    </li>

                    <!-- SESSION -->
                    <li class="nav-item">
                        <a id="id_tab_session" class="nav-link
                            {% if has_session_entries %}
                                active
                            {% endif %}
                            auto-refresh" href="#session" role="tab" data-toggle="tab">
                            <i class="material-icons">groups</i>
                            Session
                        </a>
                    </li>

                    <!-- REPORTS -->
                    <li class="nav-item">
                        <a id="id_tab_report"
                            class="nav-link auto-refresh"
                            href="#reports"
                            role="tab"
                            data-toggle="tab">
                            <i class="material-icons">description</i>
                            Reports
                        </a>
                    </li>

                </ul>

                <!-- SPINNER -->
                <div class='justify-content-center text-center'>
                    <span class="htmx-indicator">
                        <img style="width: 40px" src="{% static "assets/img/spinners/bars.svg" %}"/>
                    </span>
                </div>

            </div>

            <!-- MAIN BODY OF PAGE -->
            <div class="card-body" style="min-height: 500px;">
                <div class="tab-content tab-space pt-0">

                    <!-- SETTINGS -->
                    <div class="tab-pane" id="basics">
                        <h3 class="mt-0">Settings</h3>
                        <div id="id_pane_settings">
                            <div
                                hx-post="{% url "club_sessions:tab_settings_htmx" %}"
                                hx-trigger="load"
                                hx-vars="club_id:{{ club.id }}, session_id:{{ session.id }}"
                            ></div>
                        </div>
                    </div>

                    <!-- SESSION -->
                    <div class="tab-pane
                        {% if has_session_entries %}
                            active
                        {% endif %}

                        " id="session">

                        <!-- TOP VIEW CHOICES - SUMMARY, DETAIL, TABLE VIEWS -->

                        <div id="radio-view-options" class="btn-group btn-group-toggle" data-toggle="buttons">
                            <form class="view-type-radio"></form>

                            <!-- SUMMARY VIEW (DEFAULT) -->
                            <label class="btn btn-success active">
                                <input
                                    type="radio"
                                    name="summary"
                                    id="option-summary"
                                    autocomplete="off"
                                    checked
                                > Summary
                            </label>

                            <!-- DETAIL VIEW -->
                            <label class="btn btn-success">
                                <input
                                    type="radio"
                                    name="detail"
                                    id="option-summary"
                                    autocomplete="off"
                                > Detail
                            </label>

                            <!-- TABLE VIEW -->
                            <label class="btn btn-success">
                                <input
                                    type="radio"
                                    name="table"
                                    id="option-summary"
                                    autocomplete="off"
                                > Table View
                            </label>

                        </div>



                        <!-- THIS IS THE ACTUAL DIV FOR SESSIONS -->
                        <div id="id_pane_session"
                            hx-post="{% url "club_sessions:tab_session_htmx" %}"
                            hx-trigger="tab_load_event"
                            hx-vars="club_id:{{ club.id }}, session_id:{{ session.id }}"
                        ></div>
                    </div>

                    <!-- REPORTS -->
                    <div class="tab-pane
                        {% if has_session_entries %}
                            active
                        {% endif %}

                        " id="reports">
                        <div id="id_pane_reports"
                            {#                            hx-post="{% url "club_sessions:tab_session_htmx" %}"#}
                            {#                            hx-trigger="tab_load_event"#}
                            {#                            hx-vars="club_id:{{ club.id }}, session_id:{{ session.id }}"#}
                        >Coming Soon</div>
                    </div>


                </div>
            </div>
        </div>

    </div>

{% endblock content %}

{% block footer %}
    <script src="{% static "assets/js/plugins/bootstrap-selectpicker.js" %}"></script>

    <script>

        $(document).ready(function () {

            htmx.trigger(htmx.find('#id_pane_session'), "tab_load_event");

            // refresh the session tab every time it is clicked
            $('#id_tab_session').on('click', function (e) {
                htmx.trigger(htmx.find('#id_pane_session'), "tab_load_event");
            })

            // handle user clicking to change the view on the session tab
            $("#radio-view-options :input").change(function() {
                const selected = $(this).attr('name');

                const postData = {
                    'club_id': '{{ club.id }}',
                    'session_id': {{ session.id }},
                    'view_type': selected,
                };

                const url = '{% url "club_sessions:tab_session_htmx" %}';
                htmx.ajax('POST', url, {'target': '#id_pane_session', 'values': postData});

            });

        });

    </script>

{% endblock footer %}
