{#---------------------------------------------------------------------------------#}
{#                                                                                 #}
{# Screen to allow a director to edit the details for a single player in a session #}
{#                                                                                 #}
{#---------------------------------------------------------------------------------#}
{% load cobalt_tags %}

<!-- BUTTON TO RETURN TO SESSION PAGE -->
<button class="btn btn-outline-secondary btn-sm"
    hx-post="{% url "club_sessions:tab_session_htmx" %}"
    hx-target="#id_pane_session"
    hx-vars="club_id:{{ club.id }}, session_id:{{ session.id }}"
    {#    hx-push-url="true"#}
>
    Back To Full List
</button>

<div>
    <!-- PLAYER DETAILS -->
    {#    <div class="card card-profile">#}
    <div class="card">
        <div class="card-header card-header-{% cobalt_random_colour %}">
            <h4 class="card-title">{{ form.player.full_name }} ({{ form.player_type }})</h4>
            <h5>{{ GLOBAL_ORG }} Number: {{ session_entry.system_number }}</h5>
        </div>
        <div class="card-body">
            {% if form.is_user %}
                <div class="card-profile">
                    <img id="cobalt-pic" class="cobalt-rounded text-center" style="height: 50px; width: 50px;" src="/media/{{ player.pic }}" />
                </div>
            {% endif %}
            {% if form.is_member %}
                {{ form.membership_type }} Member
            {% else %}
                Not a member. Add.
            {% endif %}

            <ul class="text-left">
                <li>Add as member</li>
                <li>Invite to join MyABF</li>
                <li>Show balance</li>
                <li>Edit name</li>
                <li>Show/change pay for other</li>
                <li>IOU</li>
                <li>One off payments</li>
            </ul>

            <form
                hx-post="{% url "club_sessions:edit_session_entry_htmx" %}"
                hx-target="#id_pane_session"
                hx-vars="club_id:{{ club.id }}, session_id:{{ session.id }}, session_entry_id:{{ session_entry.id }}
                {% if form.is_user %}, is_user:1{% endif %}
                {% if form.is_un_reg %}, is_un_reg:1{% endif %}
                "
            >

                <div class="container">

                    <!-- PLAYER NAME - SHOWN IF CHANGED -->
                    <div id="id_player_name" class="d-none">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="bmd-label-floating" for="id_player_name_input">
                                        Changing Name To
                                    </label>
                                    <input class="form-control" id="id_player_name_input" type="text" value="" readonly>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SEARCH BUTTONS DEPENDING UPON USER TYPE -->
                    {% if form.is_user %}
                        <button id="user_change_button" type="button" class="btn btn-info" data-toggle="modal" data-target="#userSearchModal9">Change User</button>
                    {% endif %}

                    {% if form.is_un_reg %}
                        <button id="user_change_button" type="button" class="btn btn-info" data-toggle="modal" data-target="#userSearchModal99">Change User</button>
                    {% endif %}

                    <!-- PLAYER NO - HIDDEN -->
                    <input type="hidden" value="{{ form.player_no.value }}" name="player_no" id="id_player_no">

                    <!-- FEE -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                {% cobalt_bs4_field form.fee  %}
                            </div>
                        </div>
                    </div>

                    <!-- AMOUNT PAID -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                {% cobalt_bs4_field form.amount_paid  %}
                            </div>
                        </div>
                    </div>

                    <!-- PAYMENT METHOD -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="bmd-label-floating" for="id_payment_method">
                                    Payment Method
                                </label>
                                {% cobalt_bs4_field form.payment_method  %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BUTTONS -->
                <div class="row mt-5">
                    <div class="col">
                        <button id="id_save_session" class="btn btn-sm btn-success" disabled name="save_session"
                        >Save</button>

                        <button class="btn btn-sm btn-info"
                            hx-post="{% url "club_sessions:tab_session_htmx" %}"
                            hx-target="#id_pane_session"
                            hx-vars="club_id:{{ club.id }}, session_id:{{ session.id }}"
                        >Cancel</button>
                    </div>
                </div>

            </form>

        </div>
    </div>
</div>


{% include "accounts/search/user_search_include_htmx.html" with search_id=9 include_me=True callback="ChangeUser" %}
{% include "accounts/search/user_search_include_htmx.html" with unregistered=True search_id=99 include_me=True callback="ChangeUser" %}

<script>
    function ChangeUser(search_id, user_id, user_name) {
        // update player number and name and display name
        $("#id_player_no").val(user_id);
        $("#id_player_name").removeClass("d-none");
        $("#id_player_name_input").val(user_name);
        $("#user_change_button").text("Change User Again");
        $("#id_save_session").prop("disabled", false);
    };

    $(document).ready( function () {

        // Enable save button if changes are made
        // TODO: On boat - work out how to appy to all input fields
        $("#id_payment_method, #id_fee, #id_amount_paid").change(function(){
            $("#id_save_session").prop("disabled", false);
        });
    });

</script>


