{#------------------------------------------------------------------------#}
{#                                                                        #}
{# Screen for a user to edit their existing entry to an event             #}
{#                                                                        #}
{#------------------------------------------------------------------------#}

{% extends 'base.html' %}
{% load static %}
{% load cobalt_tags %}
{% load widget_tweaks %}
{% load crispy_forms_tags %}
{% block title %} - Edit Event Entry{% endblock %}

{% block header %}
    <style>
        .cobalt-left {
            text-align: left;
            padding-right: 20px;
        }

        .cobalt-table {
            margin: 0px auto;
        }

    </style>

    <link href="{% static "assets/css/bootstrap4-toggle.min.css" %}" rel="stylesheet">
    <script src="{% static "assets/js/bootstrap4-toggle.min.js" %}"></script>

{% endblock %}

{% block content %}

    <!-- IGNORE WARNING IF THERE ARE CHANGES TO SCREEN AND USER NAVIGATES AWAY -->
    <div id="ignore_cobalt_save"></div>

    <div class="container">
        <div class="row text-center">

            <!-- MAIN CARD FOR PAGE -->
            <div class="card">

                <!-- MAIN CARD HEADER FOR PAGE -->
                <div class="card-header card-header-primary">

                    <h1>
                        <div class="d-flex justify-content-between">
                            <div>
                                Edit Entry
                            </div>
                            <div>
                                <i class="material-icons" id="icon" style="font-size:60px;">edit</i>
                            </div>
                        </div>
                    </h1>

                    <h2>{{ event.event_name }} in {{ congress.name }}</h2>

                    <!-- WARNING IF NOT CHECKED OUT -->
                    {% if in_basket %}
                        <h3>This item is still in
                            {% if event_entry.primary_entrant == request.user %}
                                your shopping cart <a class="btn btn-sm btn-secondary" href="{% url "events:checkout" %}">Checkout</a></h3>
                            {% else %}
                                {{ event_entry.primary_entrant.full_name }}'s shopping cart</h3>
                            {% endif %}
                    {% endif %}
                </div>

                <!-- MAIN CARD BODY FOR PAGE -->
                <div class="card-body">

                    <!-- SHOW BUTTON LINKS -->
                    <div class="d-flex justify-content-between">
                        <div>
                            <a class="btn btn-sm btn-info" href="{% url "events:view_event_entries" congress_id=congress.id event_id=event.id %}">View all entries</a>
                        </div>
                        <div>
                            <a class="btn btn-sm btn-warning"
                                href="{% url "events:enter_event_for_another" congress_id=congress.id event_id=event.id enter_for_another=1 %}"
                            >Enter for Someone Else
                            </a>
                        </div>
                    </div>

                    <!-- INCLUDE LINKS TO OTHER ENTRIES (IF MADE) SO USER CAN EDIT THEM -->
                    <div
                        hx-get="{% url "events:get_other_entries_to_event_for_user_htmx" event_id=event.id this_event_entry_id=event_entry.id %}"
                        hx-trigger="load"
                    ></div>

                    {% if event_entry.primary_entrant == user %}
                        <h3 class="text-danger">You made this entry</h3>
                    {% else %}
                        <h3 class="text-danger">Entry made by: <b>{{ event_entry.primary_entrant.full_name }}</b></h3>
                    {% endif %}

                    <!-- OUTER WRAPPER FOR EXTRA INFO -->
                    {% if categories or event.free_format_question %}

                        {% if categories %}
                            <div class="category"><b>Category:</b> {{ event_entry.category }}</div>
                        {% endif %}

                        <div style = "border-radius: 25px; border: 2px solid grey; padding: 20px;" class="extras">

                            <!-- CATEGORIES -->
                            {% if categories %}
                                <div>
                                    <label for="id_category">Category</label>
                                    <select class="selectpicker" data-style="btn btn-info" id="id_category" name="category">
                                        {% for category in categories %}
                                            <option value="{{ category.id }}"

                                                {% if category == event_entry.category %}
                                                    selected
                                                {% endif %}

                                            >{{ category }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            {% endif %}

                            <!-- QUESTION -->
                            {% if event.free_format_question %}
                                <div>

                                    <div class="form-group">
                                        <label class="bmd-label-static">{{ event.free_format_question }}</label>
                                        <input type="text" name="question" id="id_question" class="form-control" value="{{ event_entry.free_format_answer|default_if_none:"" }}">


                                    </div>
                                    <button id="id_change" class="btn btn-sm btn-success" disabled>change answer</button>
                                </div>

                            {% endif %}
                        </div>
                    {% endif %}

                    <!-- MAIN TABLE -->

                    <div class="container" style="overflow: scroll">
                        <div class="row table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th class="px-lg-5">Player</th>
                                        <th class="px-lg-5">Actions</th>
                                        <th class="px-lg-5">Entry Fee</th>
                                        <th class="px-lg-5">Payment Method</th>
                                        <th class="px-lg-5">Status</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    {% for event_entry_player in event_entry_players %}
                                        {% include "utils/generic_user_search_body.html" with search_id=event_entry_player.id %}
                                        <tr>

                                            <!-- name and picture -->
                                            <td class="px-0 py-1 mx-0 my-2">

                                                <!-- NASTY CODE TO ENABLE POPUP -->

                                                <a href="javascript:void(0)" onclick="
                                                    swal.fire({
                                                    title: 'Details',
                                                    showClass: {
                                                    popup: 'animate__animated animate__fadeInDown'
                                                    },
                                                    hideClass: {
                                                    popup: 'animate__animated animate__fadeOutUp'
                                                    },
                                                    html: '<table class=cobalt-table>\
                                                    <tr>\
                                                        <td class=cobalt-left>Player: </td>\
                                                        <td class=cobalt-left id=popup-name-{{ event_entry_player.id }}>{{ event_entry_player.player }}</td>\
                                                    </tr>\
                                                    <tr>\
                                                        <td class=cobalt-left>Payment Method: </td>\
                                                        <td class=cobalt-left>{{ event_entry_player.get_payment_type_display }}</td>\
                                                    </tr>\
                                                    <tr>\
                                                        <td class=cobalt-left>Entry Fee Reason: </td>\
                                                        <td class=cobalt-left>{{ event_entry_player.reason|default_if_none:"" }}</td>\
                                                    </tr>\
                                                    <tr>\
                                                        <td class=cobalt-left>Entry Fee: </td>\
                                                        <td class=cobalt-left>{{ event_entry_player.entry_fee|cobalt_credits }}</td>\
                                                    </tr>\
                                                    <tr>\
                                                        <td class=cobalt-left>Paid: </td>\
                                                        <td class=cobalt-left>{{ event_entry_player.payment_received|cobalt_credits }}</td>\
                                                    </tr>\
                                                    <tr>\
                                                        <td class=cobalt-left>Payment Date: </td>\
                                                        <td class=cobalt-left>{{ event_entry_player.entry_complete_date|cobalt_nice_datetime|default_if_none:"" }}</td>\
                                                    </tr>\
                                                    <tr>\
                                                        <td class=cobalt-left>Payment By: </td>\
                                                        <td class=cobalt-left>{{ event_entry_player.paid_by|default_if_none:"" }}</td>\
                                                    </tr>\
                                                </table>',
                                                icon: 'info',
                                                confirmButtonColor: '#3085d6',
                                                cancelButtonColor: '#d33',
                                                confirmButtonText: 'Dismiss'
                                                })">


                                                <div class="px-0 py-0 mx-0 my-0 text-center">
                                                    <img id="cobalt-pic-{{ event_entry_player.id }}"
                                                        alt="profile picture for {{ event_entry_player.player.full_name }}"
                                                        class="cobalt-rounded text-center px-0 py-0  mx-0 my-0"
                                                        style="height: 60px; width: 60px;"
                                                        src="/media/{{ event_entry_player.player.pic }}" />
                                                    <p class="px-0 py-0  mx-0 my-0" id="player-name-{{ event_entry_player.id }}">
                                                        {{ event_entry_player.player.full_name }}
                                                    </p>
                                                </div>
                                            </a>
                                        </td>

                                        <!-- ACTION BUTTONS -->
                                        <td class="td-actions">
                                            <div style="white-space: nowrap;">
                                                <!-- ONLY SHOW DELETE IF PLAYER ISN'T ALREADY TBA -->
                                                <!-- ALSO, THE DELETE BUTTON IS DIFFERENT FOR PLAYERS 5 AND 6 (ACTUALLY DELETES) -->
                                                {% if event_entry_player.extra_player %}
                                                    <!-- DELETE SHOULD ACTUALLY DELETE PLAYER -->
                                                    <button type="button" id="really_delete_team_mate_{{ event_entry_player.id }}"
                                                        data-toggle="tooltip"
                                                        class="btn btn-danger really_delete_team_mate"
                                                        title="Remove {{ event_entry_player.player.first_name }} from team."
                                                    >
                                                        <i class="material-icons">delete_forever</i>
                                                    </button>
                                                {% else %} <!-- PLAYER 1 TO 4 -->
                                                    {% if event_entry_player.player.id != TBA_PLAYER %}
                                                        <button type="button" id="delete_team_mate_{{ event_entry_player.id }}"
                                                            data-toggle="tooltip"
                                                            class="btn btn-danger delete_team_mate"
                                                            title="Remove {{ event_entry_player.player.first_name }} from entry and replace with TBA."
                                                        >
                                                            <i class="material-icons">delete</i>
                                                        </button>
                                                    {% endif %}
                                                {% endif %}

                                                <!-- BUTTON TO SWAP PLAYERS -->
                                                <button type="button" id="toggle_team_mate_{{ team_mate.team_mate.id }}"
                                                    data-toggle="modal"
                                                    data-target="#cobalt_general_member_search{{ event_entry_player.id }}"
                                                    class="btn btn-warning cobalt_generic_member btn-sm">
                                                    <i class="material-icons"
                                                        title="Swap {{ event_entry_player.player.first_name }} for someone else"
                                                        data-toggle="tooltip"
                                                    >
                                                        swap_vertical_circle
                                                    </i>
                                                </button>

                                                <!-- Pay button -->
                                                {% if event_entry_player.payment_status != "Paid" and event_entry_player.payment_status != "Free" %}
                                                    <button class="btn btn-sm btn-info single_pay"
                                                        style="width: 80px"
                                                        id="single_pay_{{ event_entry_player.id }}"
                                                        data-toggle="tooltip"
                                                        title="Pay now using your bridge credits"
                                                    >Pay</button>
                                                {% endif %}


                                            </div>
                                        </td>

                                        <!-- ENTRY FEE -->
                                        <td>
                                            {{ event_entry_player.entry_fee|cobalt_credits }}
                                        </td>

                                        <!-- PAYMENT METHOD -->
                                        <td style="white-space: nowrap;">
                                            {{ event_entry_player.get_payment_type_display }}
                                            <!-- CHECK IF PAYMENT METHOD IS EDITABLE -->
                                            {% if event_entry_player.payment_status != "Paid" and event_entry_player.payment_status != "Free" %}
                                                <a class="change_payment_method" href="javascript:void(0)">
                                                    <i class="material-icons" id="change_payment_{{ event_entry_player.id }}">edit</i>
                                                </a>
                                            {% endif %}
                                        </td>

                                        <td>
                                            <div>

                                                <!-- STATUS -->
                                                <div>
                                                    {% if event_entry_player.payment_status == "Paid" %}
                                                        <span class="text-success"><i class="material-icons">check_circle</i></span>
                                                    {% elif event_entry_player.payment_status == "Free" %}
                                                        <span class="text-success"><i class="material-icons">favorite</i></span>
                                                    {% else %}
                                                        <span class="text-primary"><i class="material-icons">warning</i></span>
                                                    {% endif %}
                                                </div>
                                                <div>
                                                    {{ event_entry_player.payment_status }}
                                                </div>
                                            </div>
                                        </td>

                                        </tr>
                                    {% endfor %}

                                    <!-- BOTTOM ROW OF TABLE HAS ADD PLAYER AND PAY ALL -->
                                    <tr>
                                        <td colspan='6'>
                                            <!-- Show add player button if allowed -->
                                            {% if event_entry_players.count == 4  or event_entry_players.count == 5 %}
                                                <div class="row table-responsive text-left pb-5">
                                                    <button id="add_player" class="btn btn-sm btn-primary text-left" style="display:none"><i class="fas fa-plus-circle display-5"></i>&nbsp;Add Player to Team</button>
                                                </div>
                                            {% endif %}
                                        </td>

                                    </tbody>
                                </table>
                            </div>

                        </div>

                        <!-- COMMENTS-->
                        <label>
                            {% if event_entry.comment %}
                                Comment:
                                <strong class="text-dark">
                                    {{ event_entry.comment }}
                                </strong>
                            {% else %}Click to add comment
                            {% endif %}
                        </label>
                        <i class="material-icons text-primary" style="cursor: pointer" id="id_comment">edit</i>

                        <!-- TEAM NAME -->
                        {% if event.allow_team_names %}
                            <br>
                            <label>Team Name: <strong class="text-dark">
                                <span id="team_name_value">{{ event_entry.get_team_name }}</span>
                            </strong></label>
                            <i class="material-icons text-primary" id="id_team_name" style="cursor: pointer">edit</i></a>
                        {% endif %}

                        <!-- SHOW PAY ALL IF VALID OPTION -->
                        {% if pay_all %}
                            <div class="text-center py-3">

                                <button class="btn btn-info font-weight-bold"
                                    id="pay_all"
                                    data-toggle="tooltip"
                                    title="Pay all outstanding now using your bridge credits"
                                >Pay For Everyone</button>

                                <div>
                        {% endif %}

                    </div>
                </div>
                <div class="text-center">
                    <a href="{% url "events:delete_event_entry" event_entry_id=event_entry.id %}"
                        class="btn btn-danger cobalt-save">
                        Withdraw
                        {% if event.player_format == "Pairs" %}
                            Pair
                        {% elif event.player_format == "Individual" %}
                            Player
                        {% else %}
                            Whole Team
                        {% endif %}
                        From Event
                    </a>
                    <a href="{% url "events:congress_listing" %}" class="btn btn-success">Exit</a>
                </div>
            </div>
        </div>

{% endblock %}

{% block footer %}
    <script src="{% static "assets/js/core/jquery.cookie.min.js" %}"></script>
    <script src="{% static "assets/packages/sweetalert2.11/sweetalert2.js" %}"></script>
    <script src="{% static "assets/js/plugins/bootstrap-selectpicker.js" %}"></script>
    <script>

        {% for event_entry_player in event_entry.evententryplayer_set.all %}
            {% include "utils/generic_user_search_footer.html" with search_id=event_entry_player.id include_me=True %}
        {% endfor %}

        // edit player
        function cobaltMemberSearchOk(search_id) {
            var member = member_id[search_id];
            var name = member_name[search_id];
            var pic = member_pic[search_id];
            editPlayer(member, name, pic, search_id);
        }

        // reload page
        function reloadPage(){
            // reload page
            window.location.href = window.location.href;
        }

        function editPlayerExecute(member, name, pic, search_id) {
            // Actually change the player
            $.getJSON("{% url "events:change_player_entry_ajax" %}" + "?member_id=" + member + "&player_event_entry=" + search_id)
                .done(response => {
                if (response['message'] === "Success"){
                    // update page
                    $("#cobalt-pic-" + search_id).attr("src", "/media/" + pic);
                    $("#player-name-" + search_id).html(name);
                    $("#popup-name-" + search_id).html(name);
                    let box_title = "Player Changed";
                    if (response['user_is_player']){
                        box_title = "Removed You from this Team";
                    }
                    Swal.fire({
                        title: box_title,
                        html: response['html'],
                    }).then((result) => {
                        if (response['user_is_player']){
                            window.location.replace("/");
                        } else {
                            reloadPage();
                        }
                    })
                }
            });
        }

        function editPlayer(member, name, pic, search_id) {
            // Check if player entered already

            $.getJSON("{% url "events:check_player_entry_ajax" %}" + "?member_id=" + member + "&event_id={{ event.id }}")
                .done(response => {

                // already entered
                if (response['message'] == "Already Entered"){
                    swal.fire({
                        title: "Error",
                        html: name + " is already entered in this event",
                        icon: "error"
                    })

                } else {

                    // not entered so swap player - the search_id is the id of the player event entry

                    // If player being replaced has paid, ask the user if they want to give a refund
                    $.getJSON("{% url "events:get_player_payment_amount_ajax" %}?player_event_entry=" + search_id)
                        .done(response => {
                        if (response["refund_is_due"] === 1){
                            Swal.fire({
                                title: 'Refund ' + response["refund_who"],
                                text: "This entry has been paid for by " + response["refund_who"] + ". Would you like to give them a refund?",
                                icon: 'info',
                                showCancelButton: true,
                                showDenyButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Refund',
                                denyButtonText: 'No Refund'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    console.log("give_player_refund_ajax");
                                    $.getJSON("{% url "events:give_player_refund_ajax" %}?player_event_entry=" + search_id)
                                        .done(response => {
                                        console.log(response);
                                    });
                                    editPlayerExecute(member, name, pic, search_id)
                                } else if (result.isDenied) {
                                    editPlayerExecute(member, name, pic, search_id)
                                }
                            });
                        } else {

                            Swal.fire({
                                title: 'Change Player',
                                text: "Change player to " + name,
                                icon: 'info',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    editPlayerExecute(member, name, pic, search_id)
                                }
                            });
                        }
                    });

                }
            })
        }

        // change payment type
        function change_payment_method(event){

            var player_entry_id = event.target.id.split("_")[2];

            var input_options = {

                {% for payment_method in payment_methods %}
                    '{{ payment_method.0 }}': '{{ payment_method.1 }}',
                {% endfor %}

            }

            // TODO: Add in their-bridge-credits and ask them as options if not the logged in user

            // This seems be to needed to force Django's late/lazy eval stuff to actually work
            // Doesn't make any sense but fails without it
            console.log(input_options);

            (async () => {

                const {value: payment_method} = await swal.fire({
                    title: 'Change Payment Method',
                    input: 'select',
                    inputOptions: input_options,
                    inputPlaceholder: 'Select method',
                    showCancelButton: true,
                })

                if (payment_method) {
                    $.getJSON("{% url "events:change_payment_method_on_existing_entry_ajax" %}?player_entry_id=" + player_entry_id + "&payment_method=" + payment_method)
                        .done(response => {
                        console.log("hello");
                        console.log(response);
                        if (response['message'] == "Success"){
                            Swal.fire({
                                title: 'Payment Method Changed',
                                html: 'Payment method successfully changed',
                            }).then((result) => {
                                reloadPage();
                            });
                        }
                    });
                }
            })()

        }

        $(document).ready(function() {

            if (window.performance.navigation.type === 2) {
                // the page was navigated to via the forward or back button
                // refresh to make sure auto top up status is correct
                location.reload();
            }

            // initialise tooltips
            $('[data-toggle="tooltip"]').tooltip()

            // poke the selectpicker
            $('.selectpicker').selectpicker('refresh');

            // Handle comment edit button being clicked
            $("#id_comment").on("click", function(){
                editComment({{event_entry.id}}, "{{event_entry.comment}}")
            });

            // Hide tooltip if clicked - problem for mobile devices - it gets in the way
            $('.cobalt_generic_member, .delete_team_mate').click(function(){
                $(".tooltip").tooltip("hide");
            });

            // handle delete button - replace player with TBA
            $(".delete_team_mate").click(function(){
                var search_id = $(this).attr('id').split("_")[3];
                editPlayer({{ TBA_PLAYER }}, "TBA", "pic_folder/tba.png", search_id);
            });

            // handle really delete button - delete player
            $(".really_delete_team_mate").click(function(){
                var search_id = $(this).attr('id').split("_")[4];
                $.getJSON("{% url "events:delete_player_from_entry_ajax" %}?event_entry_player_id=" + search_id)
                    .done(response => {
                    if (response['message'] == "Success"){
                        reloadPage();
                    }
                });
            });

            // handle add player
            $("#add_player").click(function(){

                $.getJSON("{% url "events:add_player_to_existing_entry_ajax" %}?event_entry_id={{ event_entry.id }}")
                    .done(response => {
                    if (response['message'] == "Success"){
                        reloadPage();
                    }
                });
            });

            // handle categories
            $("#id_category").on("change", function(){
                var category = $("#id_category").val();
                $.getJSON("{% url "events:change_category_on_existing_entry_ajax" %}/{{ event_entry.id }}/" + category)
                    .done(response => {
                    if (response['message'] == "Success"){
                        Swal.fire({
                            title: 'Category Changed',
                            html: 'Category successfully changed',
                        });
                    }
                });
            });

            // handle change question
            $("#id_change").click(function(){
                var answer = $("#id_question").val();
                $.getJSON("{% url "events:change_answer_on_existing_entry_ajax" %}/{{ event_entry.id }}/" + encodeURIComponent(answer))
                    .done(response => {
                    if (response['message'] == "Success"){
                        Swal.fire({
                            title: 'Answer Changed',
                            html: 'Answer successfully changed',
                        });
                    }
                });

            });

            // handle single player payment
            $(".single_pay").click(function(){

                // hide tooltips - problem on tablets
                $(".tooltip").tooltip("hide");

                Swal.fire({
                    title: 'Pay with Your Bridge Credits',
                    text: "Pay for this player now using your Bridge Credits?",
                    icon: 'info',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Pay with My Bridge Credits'
                }).then((result) => {
                    if (result.value) {

                        $(this).prop('disabled', true);
                        var pay_id = $(this).attr('id').split("_")[2];
                        window.location.href = "{% url "events:third_party_checkout_player" %}/" + pay_id;
                    }
                });
            });

            // handle pay all
            $("#pay_all").click(function(){

                Swal.fire({
                    title: 'Pay with Your Bridge Credits',
                    text: "Pay for all outstanding players now using your Bridge Credits?",
                    icon: 'info',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Pay with My Bridge Credits'
                }).then((result) => {
                    if (result.value) {

                        $(this).prop('disabled', true);
                        window.location.href = "{% url "events:third_party_checkout_entry" event_entry_id=event_entry.id %}";
                    }
                });
            });

            // handle question changing
            $("#id_question").on("keyup", function(){
                $("#id_change").prop("disabled", false);
            })

            // handle edit payment type
            $(".change_payment_method").on('click', change_payment_method)

            // edit team name
            {% if event.allow_team_names %}

                $("#id_team_name").click(function(){
                    const team_name = $("#team_name_value").text()
                    Swal.fire({
                        title: 'Team Name',
                        input: 'text',
                        inputValue: team_name,
                        inputAttributes: {
                            maxlength: 15
                        },
                        showCancelButton: true
                    }).then(function(result) {
                        if(!result.isDismissed){

                            var url = "{% url "events:edit_team_name_event_entry_ajax" %}";
                            var serializedData = {
                                "id": {{ event_entry.id }},
                                "team_name": result.value
                            };

                            $.ajax({
                                url: url,
                                headers: {
                                    "Content-Type": "application/json",
                                    "X-CSRFToken": '{{ csrf_token }}' // This is needed to pass xsite scripting errors
                                },

                                type: "post",
                                data: JSON.stringify(serializedData),
                                dataType: "json",
                                success: function(response) {
                                    swal.fire({
                                        title: "Team Name updated",
                                        html: response.message,
                                        icon: "success",
                                    }).then(function() {
                                        location.reload();
                                    });
                                },
                            });
                        } // dismissed - don't do anything
                    })
                });
            {% endif %}

        }); // end doc ready

        // edit comment and show it as well
        function editComment(id, old_comment) {

            Swal.fire({
                title: 'Comments',
                input: 'text',
                inputValue: old_comment,
                inputPlaceholder: 'Comments...',
                inputAttributes: {
                    'aria-label': 'Comments'
                },
                showCancelButton: true
            }).then(function(result) {
                if(!result.isDismissed){

                    var url = "{% url "events:save_comment_for_event_entry_ajax" %}";
                    var serializedData = {
                        "id": id,
                        "comment": result.value
                    };

                    $.ajax({
                        url: url,
                        headers: {
                            "Content-Type": "application/json",
                            "X-CSRFToken": '{{ csrf_token }}' // This is needed to pass xsite scripting errors
                        },
                        type: "post",
                        data: JSON.stringify(serializedData),
                        dataType: "json",
                        success: function(response) {
                            swal.fire({
                                title: "Comment updated",
                                html: response.message,
                                icon: "success",
                            }).then(function() {
                                location.reload();
                            });
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            console.log(textStatus, errorThrown);
                        }
                    });
                } // dismissed - don't do anything
            })
        }
    </script>
{% endblock %}
