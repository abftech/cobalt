{#------------------------------------------------------------------------#}
{#                                                                        #}
{# Returns the formatted table data for the congress listing              #}
{#                                                                        #}
{#------------------------------------------------------------------------#}
{% load cobalt_tags %}

<!-- HANDLE NO DATA -->

{% if not month_list %}

    <!-- Different message for forwards and backwards -->
    {% if reverse_list %}
        <h3>You are at the end of the data.</h3>
    {% else %}
        <h3>No data found. Change your filters or search.</h3>
    {% endif %}

{% else %}

    <!-- WE HAVE DATA -->

    <!-- ICON TO GO BACKWARDS IN TIME FOR REVERSE VIEW -->
    {% if last_date %}
        <a
            href="javascript: void(0)"
            class="btn btn-success btn-sm"
            hx-post="{% url "events:next_version_data_htmx" %}"
            hx-include="[id='events_form']"
            hx-target="#events_list"
            hx-trigger="click"
            hx-vars="last_date:'{{ last_date }}',reverse_list: 'reverse'

            {% if previous_date %}
                ,previous_date:'{{ previous_date }}'
            {% else %}
                ,previous_date:'{{ last_date }}'
            {% endif %}

            "
        >
            <span class="material-icons" style="font-size: x-large">fast_rewind</span>
        </a>
    {% endif %}

    <!-- ICON TO GO FORWARDS IN TIME FOR REVERSE VIEW -->

    {% if previous_date %}
        <a
            href="javascript: void(0)"
            class="btn btn-success btn-sm"
            hx-post="{% url "events:next_version_data_htmx" %}"
            hx-include="[id='events_form']"
            hx-target="#events_list"
            hx-trigger="click"
            hx-vars="previous_date:'{{ previous_date }}',reverse_list: 'reverse'"
        >
            <span class="material-icons" style="font-size: x-large">fast_forward</span>
        </a>

    {% endif %}

    {% if reverse_list %}
        <h3>{{ ref_date_start }} back to {{ ref_date_end }}</h3>
    {% endif %}

    {% for month,congresses in month_list.items %}

        <div class="card">
            <div class="card-header card-header-{% cobalt_random_colour %}">
                <h3 class="text-center by-0 my-0 py-0">{{ month }}</h3>
            </div>
            <div class="card-body">

                <div class="table-responsive">
                    <table class="table table-striped fixed-congress">
                        <thead>
                            <tr class="text-primary">
                                <th>Start Date</th>
                                <th>Congress</th>
                                <th>State</th>
                                <th>Congress Type</th>
                                <th>Organiser</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for congress in congresses %}
                                <tr class="congress-link-row" data-href="{% url "events:view_congress" congress_id=congress.id %}">
                                    <td>{{ congress.start_date }}</td>
                                    <td>{{ congress.name }}</td>
                                    <td>{{ congress.congress_master.org.state }}</td>
                                    <td>{{ congress.get_congress_type_display|title }}</td>
                                    <td>{{ congress.congress_master.org }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    {% endfor %}

    {% if last_date %}
        <button
            class="btn btn-info"
            hx-post="{% url "events:next_version_data_htmx" %}"
            hx-include="[id='events_form']"
            hx-target="#events_list"
            hx-trigger="click"
            hx-vars="last_date:'{{ last_date }}',

            {% if reverse_list %}
                reverse_list: 'reverse'
            {% endif %}

            "
            _="on click go to the top of the body smoothly"
        >
            Previous 6 Months
        </button>
    {% endif %}

    <script>
        $(document).ready(function () {

            // make the whole row clickable for the table
            $(".congress-link-row").click(function () {
                window.location = $(this).data("href");
            });
        });
    </script>

{%endif %}
