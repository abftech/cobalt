{% extends 'base.html' %}
{% load cobalt_tags %}
{% block title %} - Manual Adjust Organisation{% endblock %}
{% block content %}

    <nav aria-label="breadcrumb" role="navigation">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url "payments:statement_admin_summary" %}">Payments Admin</a></li>
            <li class="breadcrumb-item active" aria-current="page">Manual Adjust Organisation</li>
        </ol>
    </nav>

    <div class="">
        <div class="card">
            <div class="card-header card-header-primary">
                <h1>{{ BRIDGE_CREDITS }}</h1>
                <h2>Manual Adjust Organisation Account<span id="org">{% if org %} - {{ org.name }}{% endif %}</span></h2>
                <h3 >Use negative numbers to remove money from organisations account</h3>
            </div>
            <div class="card-body table-responsive">

                <div id="cobalt_form"

                >
                    <div class="col-md-6">

                        <form method="POST">
                            {% csrf_token %}
                            {% if org %}
                                <input type='hidden' id='id_organisation' name='organisation' value='{{ org.id }}'>
                            {% else %}

                                {% include "generic_org_search_body.html" %}
                                <a class="cobalt_generic_org btn btn-warning btn-sm" data-toggle="modal" id="id_org_search" data-target="#cobalt_general_org_search"><span style="color: white;">Organisation Search</span></a>

                            {% endif %}

                            <div id="cobalt-hidden-org"></div>
                            {% cobalt_bs4_field form.amount %}
                            <div class="row pb-3">
                                <div class="col-4 pt-3">Transaction Type</div>
                                <div class="col-8">
                                    {% cobalt_bs4_field form.adjustment_type %}
                                </div>
                            </div>

                            {% cobalt_bs4_field form.description %}


                            <div>
                                <button type="submit" class="btn btn-success center-text cobalt-save">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block footer %}
    <script>
        {% if org %}
            $('#id_adjustment_type').change(function(){
                const amt = $('#id_amount').val() || 0;
                const fees = {{ org.settlement_fee_percent }};
                let settlement = 0;
                if (amt !== 0) {
                    settlement = amt - (amt * fees / 100.0);
                }
                console.log($('#id_description'));
                $('#id_description').val('Settlement from {{ GLOBAL_ORG }}. Fees ' + fees.toFixed(2) + '%. Net Bank Transfer: {{ GLOBAL_CURRENCY_SYMBOL }}' + -settlement.toFixed(2))
                $('#id_description').trigger("change");
            });
        {% else %}
            {% include 'generic_org_search_footer.html' %}

            $('#cobalt_general_org_search').modal('show');

            function cobaltOrgSearchOk() {
                // Show form now that search is complete
                $("#cobalt_form").show();
                $("#id_org_search").hide();
                $("#cobalt-hidden-org").html("<input type='hidden' id='id_organisation' name='organisation' value='" + org_id + "'>");
                $("#org").html(" - " + org_name);
                clearModalOrg();
            }
        {% endif %}
    </script>


{% endblock %}
