files:
  "/etc/newrelic-infra.yml" :
    mode: "000644"
    owner: root
    group: root
    content: |
      license_key: YOUR_LICENSE_KEY

  "/tmp/relic_config" :
    mode: "000755"
    owner: root
    group: root
    content: |
      CONFIG_FILE=`cat /opt/elasticbeanstalk/deployment/env | grep NEW_RELIC_CONFIG_FILE | tr "=" " " | awk '{print $2}'`
      LICENSE=`grep license_key $CONFIG_FILE | awk '{print $3}'`
      echo "license_key: $LICENSE" > /etc/newrelic-infra.yml

commands:
# Create the agentâ€™s yum repository
  "01-agent-repository":
    command: sudo curl -o /etc/yum.repos.d/newrelic-infra.repo https://download.newrelic.com/infrastructure_agent/linux/yum/amazonlinux/2/x86_64/newrelic-infra.repo
#
# Update your yum cache
  "02-update-yum-cache":
    command: yum -q makecache -y --disablerepo='*' --enablerepo='newrelic-infra'
#
# Update the licence key
  "03-licence-key":
    command: sudo /tmp/relic_config
#
# Run the installation script
  "04-run-installation-script":
    command: sudo yum install newrelic-infra -y

