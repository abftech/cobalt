{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load cobalt_tags %}
{% block title %}- Club Menu {{ club }}{% endblock %}

{% block content %}

    {% if other_clubs %}
        <h4>You have access to multiple clubs, change club:</h4>
        {% for other_club in other_clubs %}
            <a href="{% url "organisations:club_menu" club_id=other_club.id %}" class="btn btn-sm btn-{% cobalt_random_colour %}">{{ other_club }}</a>
        {% endfor %}
    {% endif %}

    <h1 class="text-center pt-4"><span id="t_club_name">{{ club }}</span> - {{ club.state }}</h1>
    <h2 class="text-center"><span class="text-primary">&clubs;</span> Club Menu <span class="text-danger">&clubs;</span></h2>

    <div class="card-body">
        <div class="card">
            <div class="card-header card-header-secondary">
                <ul id="id_menu" class="nav nav-pills nav-pills-icons" role="tablist">
                    <li class="nav-item">
                        <a id="id_tab_dashboard" class="nav-link active auto-refresh" href="#dashboard" role="tab" data-toggle="tab">
                            <i class="material-icons">space_dashboard</i>
                            Club
                        </a>
                    </li>
                    <li class="nav-item">
                        <a id="id_tab_members" class="nav-link" href="#members" role="tab" data-toggle="tab">
                            <i class="material-icons">manage_accounts</i>
                            Members
                        </a>
                    </li>

                    {% if show_congress %}

                        <li class="nav-item">
                            <a id="id_tab_congress" class="nav-link" href="#congress" role="tab" data-toggle="tab">
                                <i class="material-icons">book_online</i>
                                Congresses
                            </a>
                        </li>

                    {% endif %}

                    <li class="nav-item">
                        <a id="id_tab_results" class="nav-link" href="#results" role="tab" data-toggle="tab">
                            <i class="material-icons">content_paste</i>
                            Results
                        </a>
                    </li>
                    <li class="nav-item">
                        <a id="id_tab_comms" class="nav-link" href="#comms" role="tab" data-toggle="tab">
                            <i class="material-icons">alternate_email</i>
                            Communications
                        </a>
                    </li>

                    {% if show_finance %}

                        <li class="nav-item">
                            <a id="id_tab_finance" class="nav-link" href="#finance" role="tab" data-toggle="tab">
                                <i class="material-icons">monetization_on</i>
                                Finance
                            </a>
                        </li>

                    {% endif %}

                    <li class="nav-item">
                        <a id="id_tab_access" class="nav-link" href="#access" role="tab" data-toggle="tab">
                            <i class="material-icons">face</i>
                            Access
                        </a>
                    </li>
                    <li class="nav-item">
                        <a id="id_tab_settings" class="nav-link" href="#settings" role="tab" data-toggle="tab">
                            <i class="material-icons">settings</i>
                            Settings
                        </a>
                    </li>
                </ul>
                <div class='justify-content-center text-center'>
                    <span class="htmx-indicator">
                        <img src="{% static "assets/img/spinners/bars.svg" %}"/>
                    </span>
                </div>

            </div>
            <div class="card-body">
                <div class="tab-content tab-space">
                    <div class="tab-pane active" id="dashboard">
                        {% include "organisations/club_menu/dashboard.html" %}
                    </div>
                    <div class="tab-pane" id="members">
                        {% include "organisations/club_menu/members.html" %}
                    </div>
                    <div class="tab-pane" id="congress">
                        {% include "organisations/club_menu/congress.html" %}
                    </div>

                    <div class="tab-pane" id="results">
                        {% include "organisations/club_menu/results.html" %}
                    </div>
                    <div class="tab-pane" id="comms">
                        {% include "organisations/club_menu/comms.html" %}
                    </div>
                    <div class="tab-pane" id="finance">
                        {% include "organisations/club_menu/finance.html" %}
                    </div>
                    <div class="tab-pane" id="access">
                        {% include "organisations/club_menu/access.html" %}
                    </div>
                    <div class="tab-pane" id="settings">
                        {% include "organisations/club_menu/settings.html" %}
                    </div>
                </div>
            </div>
        </div>
    </div>


{% endblock content %}

{% block footer %}
    {% include "utils/include_htmx.html" %}
    {% include "accounts/user_search_include_js_htmx.html" %}

    <script>
        $(document).ready(function () {

            // When a tab is clicked for the first time, we load the data

            $('#id_menu a').on('click', function (e) {

                // get matching panel id from this id
                // this.id is something like 'id_tab_dashboard' and the placeholder in the panel is 'id_panel_dashboard'
                // this isn't a proper this so to get the classes we need to create the tab variable

                const id = this.id.split("_")[2];
                const panel_id = '#id_panel_' + id;
                const tab_id = '#id_tab_' + id;
                const panel = $(panel_id);
                const tab = $(tab_id);

                // allow auto refresh using auto-refresh class
                // only auto-refresh if another tab could have changed our values
                if (panel.html().length === 0 || tab.hasClass('auto-refresh')) {
                    htmx.trigger(htmx.find(panel_id), "tab_load_event");
                }
            })

            // first time load the active tab
            htmx.trigger(htmx.find("#id_panel_dashboard"), "tab_load_event");
        });
    </script>
{% endblock footer %}
