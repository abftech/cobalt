{% load cobalt_tags %}
<h2>Total Members - {{ total_members }}</h2>

<div class="card">
    <div class="card-header card-header-info py-2 my-2">
        <h3 class="my-0 py-1">{{ GLOBAL_TITLE }} Users ({{ cobalt_members.count }})</h3>
        <p class="font-italic my-0 py-1">These users are registered for the system.</p>
    </div>
    <div class="card-body">

        <table class="table table-hover">
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>{{ GLOBAL_ORG }} Number</th>
                </tr>
            </thead>
            <tbody>

                {% for cobalt_member in cobalt_members %}
                    <tr>
                        <td><a href="{% url "accounts:public_profile" pk=cobalt_member.id %}" target="_blank">{{ cobalt_member.first_name }}</a></td>
                        <td><a href="{% url "accounts:public_profile" pk=cobalt_member.id %}" target="_blank">{{ cobalt_member.last_name }}</a></td>
                        <td><a href="{% url "accounts:public_profile" pk=cobalt_member.id %}" target="_blank">{{ cobalt_member.system_number }}</a></td>
                    </tr>
                {% endfor %}
            </tbody>

        </table>
    </div>
</div>

<div class="card">
    <div class="card-header card-header-info py-2 my-2">
        <h3 class="my-0 py-1">Unregistered Users ({{ unregistered_members.count }})</h3>
        <p class="font-italic my-0 py-1">These users are yet to register for the system. You can invite them to join and enjoy the benefits for free.</p>
    </div>
    <div class="card-body">

        <table id="id_member_un_reg_table" class="table table-hover" style="display: none;">
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>{{ GLOBAL_ORG }} Number</th>
                </tr>
            </thead>
            <tbody>
                {% for unregistered_member in unregistered_members %}
                    <tr>
                        <td> <a href="#" hx-post="{% url "organisations:club_menu_tab_members_un_reg_edit_htmx" %}"
                            hx-indicator=".htmx-indicator"
                            hx-target="#id_panel_members"
                            hx-vars="club_id:{{ club.id }}, un_reg_id:{{ unregistered_member.id }}">
                            {{ unregistered_member.first_name }}
                        </a></td>
                        <td> <a href="#" hx-post="{% url "organisations:club_menu_tab_members_un_reg_edit_htmx" %}"
                            hx-indicator=".htmx-indicator"
                            hx-target="#id_panel_members"
                            hx-vars="club_id:{{ club.id }}, un_reg_id:{{ unregistered_member.id }}">
                            {{ unregistered_member.last_name }}
                        </a></td>
                        <td> <a href="#"  hx-post="{% url "organisations:club_menu_tab_members_un_reg_edit_htmx" %}"
                            hx-indicator=".htmx-indicator"
                            hx-target="#id_panel_members"
                            hx-vars="club_id:{{ club.id }}, un_reg_id:{{ unregistered_member.id }}">
                            {{ unregistered_member.system_number }}
                        </a></td>
                    </tr>

                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<button class="btn bg-primary"
    hx-post="{% url "organisations:club_menu_tab_members_upload_csv" %}"
    hx-indicator=".htmx-indicator"
    hx-target="#id_panel_members"
>Pianola Upload</button>

<button class="btn bg-primary"
    hx-post="{% url "organisations:club_menu_tab_members_import_mpc_htmx" %}"
    hx-indicator=".htmx-indicator"
    hx-target="#id_panel_members"
    onClick="this.disabled=true;"
>MPC Import</button>

<script>
    $(document).ready( function () {

        // Initialise datatable - only show pagination if more than one page, sort in order, column 0

        $('#id_member_un_reg_table').DataTable();

        {#$('#id_member_un_reg_table').DataTable({#}
        {#    "order": [[2, "desc"]],#}
        {#    drawCallback: function (settings) {#}
        {#        const pagination = $(this).closest('.dataTables_wrapper').find('.dataTables_paginate');#}
        {#        pagination.toggle(this.api().page.info().pages > 1);#}
        {#    }#}
        {#bAutoWidth: false,#}
        {#aoColumns: [#}
        {#    {sWidth: '10%'},#}
        {#    {sWidth: '10%'},#}
        {#    {sWidth: '10%'},#}
        {#    {sWidth: '10%'},#}
        {#    {sWidth: '10%'},#}
        {#    {sWidth: '10%'},#}
        {#    {sWidth: '40%'}#}
        {#]#}
        {#});#}

        // Unhide table now. This avoids the flicker
        $('#id_member_un_reg_table').show();

    });

</script>
