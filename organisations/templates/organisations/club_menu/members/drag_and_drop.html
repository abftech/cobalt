<div class="container">
    <h5 class="text-center">Drag and Drop tags to move them</h5>
    <div class="card">
        <div class="card-header card-header-primary">
            <h3>{{ member.first_name }}'s Tags</h3>
        </div>
        <div id="member_tags" class="card-body" ondrop="drop(event)" ondragover="allowDrop(event)">

            {% for tag in member_tags %}
                <button id="item_{{ tag.club_tag.id }}" draggable="true" ondragstart="drag(event)" class="btn btn-sm btn-danger">{{ tag.club_tag.tag_name }}</button>
            {% endfor %}

        </div>
    </div>

    <div class="card">
        <div class="card-header card-header-info">
            <h3>Available Tags</h3>
        </div>
        <div class="card-body" id="available_tags" ondrop="drop(event)" ondragover="allowDrop(event)">

            {% for tag in available_tags %}
                <button id="item_{{ tag.id }}" draggable="true" ondragstart="drag(event)" class="btn btn-sm btn-default">{{ tag.tag_name }}</button>
            {% endfor %}

        </div>
    </div>
    <h4 class="text-info font-weight-bold settings_message" id="tag_message"></h4>
</div>
</div>

<script>
    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        ev.dataTransfer.setData("text", ev.target.id);
    }

    function drop(ev) {
        ev.preventDefault();

        // Only allow drop on div, not on other elements

        // Add to list of tags for this member
        if (ev.target.id === "member_tags"){
            const id = ev.dataTransfer.getData("text");
            ev.target.appendChild(document.getElementById(id));

            const moved = $("#" + id);
            moved.addClass("btn-danger");
            moved.removeClass("btn-default");

            postData = {
                'club_id': {{ club.id }},
                'tag_id': id.split("_")[1],
                'system_number': {{ member.system_number }}
            };

            const url = '{% url "organisations:club_menu_tab_comms_tags_add_user_tag" %}';
            htmx.ajax('POST', url, {'target': '#tag_message', 'values': postData});
        }

        // remove from list of tags for this member
        if (ev.target.id === "available_tags"){
            const id = ev.dataTransfer.getData("text");
            ev.target.appendChild(document.getElementById(id));

            const moved = $("#" + id);
            moved.addClass("btn-default");
            moved.removeClass("btn-danger");
            postData = {
                'club_id': {{ club.id }},
                'tag_id': id.split("_")[1],
                'system_number': {{ member.system_number }}
            };
            const url = '{% url "organisations:club_menu_tab_comms_tags_remove_user_tag" %}';
            htmx.ajax('POST', url, {'target': '#tag_message', 'values': postData});
        }
    }

</script>
