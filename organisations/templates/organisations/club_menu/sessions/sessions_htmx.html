{#------------------------------------------------------------------------#}
{#                                                                        #}
{# Main page for sessions tab                                             #}
{#                                                                        #}
{#------------------------------------------------------------------------#}
<ul>

    <li>Get rid of pretty much all the code but keep the data model and strengthen it</li>
    <li>Happy flow should be load file -> done</li>
    <li>Get rid of extra payments from normal workflow - link only</li>
    <li>Show confirm screen with expandable list of Bridge Credits, IOUs, Cash</li>
    <li>Pay for someone else should be done through payments</li>
    <li>Handle messages on creating new session - maybe store on db object for session</li>
    <li>Screen freeze after uploading file - change to reload whole screen</li>
    <li>Quick option to make payments too</li>
    <li>Default scoring program for club - allow override but automatically choose the correct one</li>
    <li>Selector for session type (F2F or Online etc) before creating session</li>
    <li>Title of session from file</li>
    <li>Move secondary payment method onto org</li>
    <li>Fix popup window detect HTMX error when adding 2nd session</li>

</ul>

{% if things %}

    <div class="table-responsive">
        <table class="table table-hover table-condensed">
            <thead>
                <tr class="text-primary">
                    <th>Session</th>
                    <th>Date</th>
                    <th>Director</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for thing in things %}
                    <tr>
                        <td>{{ thing.description }}</td>
                        <td>{{ thing.session_date }}</td>
                        <td>{{ thing.director.full_name }}</td>
                        <td>
                            <a target="_blank" href="{% url "club_sessions:manage_session" session_id=thing.id %}" class="btn btn-sm btn-success">Edit</a>
                        </td>

                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% include 'utils/pagination_footer_htmx.html' with hx_target="#id_panel_sessions" %}

{% else %}
    <h3>This club has not run any sessions yet</h3>

{% endif %}

<script>

    // Check if this page goes to the background. Refresh list if user returns.
    var is_foreground = true;

    function checkDocumentVisible() {
        if (document.visibilityState === 'visible' && is_foreground === false) {
            is_foreground = true;

            // get HTMX to refresh list
            postData = {
                'club_id': {{ club.id }},
            };

            const url = '{% url "organisations:club_menu_tab_sessions_htmx" %}';
            htmx.ajax('POST', url, {'target': '#id_panel_sessions', 'values': postData});

        } else if (document.visibilityState !== 'visible' && is_foreground === true) {
            is_foreground = false;
        }
    }

    $(document).ready( function () {
        setInterval(checkDocumentVisible, 1000);
    });

</script>
