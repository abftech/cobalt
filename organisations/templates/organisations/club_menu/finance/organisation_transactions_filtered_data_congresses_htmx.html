{% load cobalt_tags %}
{#------------------------------------------------------------------------#}
{#                                                                        #}
{# show org transaction search results grouped by congress                #}
{#                                                                        #}
{#------------------------------------------------------------------------#}
{% if things %}

    {% if balance_at_end_date %}
        <h3>Balance as at {{ end_datetime|cobalt_nice_date_short }}: {{ balance_at_end_date|cobalt_currency_colour  }},
            Total for congresses: {{ congresses_total|cobalt_currency_colour }}
        </h3>
    {% endif %}

    <div class="table-responsive">
        <table class="table table-condensed table-hover">
            <thead>
                <tr>
                    <th class="text-left">Start Date</th>
                    <th class="text-left">Congress Name</th>
                    <th class="text-right">Total Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for thing in things %}
                    <tr>
                        <td class="text-left">{{ thing.start_date }}</td>
                        <td class="text-left">
                            <a
                                href="#"
                                hx-target="#id_filtered_transactions"
                                {# Special case of deleted events congress_id=-1 #}
                                {% if thing.id  == -1 %}
                                    hx-post="{% url 'organisations:transaction_congress_details_deleted_events_htmx' %}"
                                    hx-vars="club_id: {{ club.id }}, start_date: '{{ start_date }}', end_date: '{{ end_date }}'"

                                {% else %}
                                    hx-post="{% url 'organisations:transaction_congress_details_htmx' %}"
                                    hx-vars="club_id: {{ club.id }}, congress_id: {{ thing.id }}, use_filtered_view: 1"
                                {% endif %}
                            >
                                {{ thing.congress_name }}
                            </a>
                        </td>
                        <td class="text-right">
                            {% if thing.amount_outside_range != 0 %}
                                <button class="btn btn-xs btn-danger" data-toggle="tooltip" title="Payments of {{ thing.amount_outside_range }} were made outside the selected date range, or refunds different from payments.">!</button>
                            {% endif %}
                            {{ thing.amount|cobalt_currency_colour }}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% include "utils/pagination_footer_htmx.html" %}

{% else %}

    <h4>No data found</h4>

{% endif %}

<script>
    $(document).ready( function () {
        // initialise tooltips
        $('[data-toggle="tooltip"]').tooltip()
    });
</script>
