{% extends 'base.html' %}
{% load cobalt_tags %}
{% block title %} - Notifications Emails{% endblock %}
{% block content %}

    <div class="jumbotron">
        <div class="card col-lg-10 mx-auto">
            <div class="card-header card-header-warning">
                <h1>
                    <div class="d-flex justify-content-between">
                        <div>
                            System Generated Emails
                        </div>
                        <div>
                            <i class="material-icons" id="icon" style="font-size:60px;">email</i>
                        </div>
                    </h1>

                </div>
                <div class = "card-body">
                </div>
                <div class="card-body table-responsive">


                    <table class="table table-hover table-condensed">
                        <thead class="text-info">
                            <tr>
                                <th class="text-left">Date</th>
                                <th class="text-left">Status</th>
                                <th class="text-left">Sent To (first name in list)</th>
                                <th class="text-left">Subject</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for thing in things %}
                                <tr>
                                    <td class="text-left">{{ thing.snooper.ses_sent_at|cobalt_nice_datetime }}</td>

                                    {# show real status #}
                                    <td class="text-left">
                                        {% if thing.status != 0 %}
                                            {{ thing.get_status_display }}
                                        {% else %}
                                            {% if thing.snooper.ses_bounce_reason %}
                                                {% if thing.snooper.ses_bounce_reason == "Permanent: General" %}
                                                    Hard Bounce
                                                {% else %}
                                                    Soft Bounce
                                                {% endif %}
                                            {% elif thing.snooper.ses_clicked_at %}
                                                Clicked
                                            {% elif thing.snooper.ses_opened_at %}
                                                Opened
                                            {% elif thing.snooper.ses_delivered_at %}
                                                Delivered
                                            {% elif thing.snooper.ses_sent_at %}
                                                Sent
                                            {% else %}
                                                Unknown
                                            {% endif %}
                                        {% endif %}
                                    </td>

                                    <td class="text-left" data-toggle="tooltip" title="{{ thing.to.0 }}">{{ thing.to.0|cobalt_hide_email }}</td>
                                    <td class="text-left">{{ thing.subject }}</td>
                                    <td><a onClick='showEmail({{ thing.id }})'
                                        class="btn btn-sm btn-info">View</a>
                                    </td>
                                </tr>
                            {% endfor %}

                        </tbody>
                    </table>
                </div>
            </div>
            {% include 'utils/pagination_footer.html' %}
        </div>

{% endblock %}

{% block footer %}
    <script>

        function showEmail(id) {
            var newWin = window.open('{% url "notifications:admin_view_email" %}/' + id, 'email', 'width=1000,height=1500');
        }

        $(document).ready(function() {
            // initialise tooltips
            $('[data-toggle="tooltip"]').tooltip()

        });
    </script>
{% endblock %}
